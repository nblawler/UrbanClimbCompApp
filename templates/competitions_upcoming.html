\<!doctype html>
<html lang="en">
<head>
	<meta charset="utf-8" />
	<meta name="viewport" content="width=device-width, initial-scale=1" />
	<title>
		{% if competitor %}
			Home ¬∑ Upcoming Competitions ¬∑ {{ competitor.name }}
		{% else %}
			Home ¬∑ Upcoming Competitions ¬∑ Urban Climb Comp
		{% endif %}
	</title>
	<link rel="stylesheet" href="/static/app.css" />
</head>
<body>
	{# Logged-in info #}
	{% set viewer_id = viewer_id if viewer_id is defined else session.get('competitor_id') %}
	{% set is_admin = session.get('admin_ok', False) %}

	<nav class="container top-nav">
		<div class="nav-links">
			{% if is_admin %}
				{# üîê ADMIN VIEW: only Home, Admin, Login #}
				<a
					class="back {% if nav_active == 'my_comps' %}active{% endif %}"
					href="/my-comps"
				>
					Home
				</a>

				<a
					class="back {% if nav_active == 'admin' %}active{% endif %}"
					href="/admin/comps"
				>
					Admin
				</a>

				<a
					class="back {% if nav_active == 'login' %}active{% endif %}"
					href="/login"
				>
					Log in
				</a>

			{% elif competitor %}
				{# NORMAL COMPETITOR VIEW #}
				<a
					class="back {% if nav_active == 'my_comps' %}active{% endif %}"
					href="/my-comps"
				>
					Home
				</a>

				<a
					class="back {% if nav_active == 'sections' %}active{% endif %}"
					href="/competitor/{{ competitor.id }}/sections"
				>
					My Scoring
				</a>

				<a
					class="back {% if nav_active == 'leaderboard' %}active{% endif %}"
					href="/leaderboard?cid={{ competitor.id }}"
				>
					Leaderboard
				</a>

				<a
					class="back {% if nav_active == 'login' %}active{% endif %}"
					href="/login"
				>
					Log in
				</a>

			{% else %}
				{# NOT LOGGED IN #}
				<a
					class="back {% if nav_active == 'my_comps' %}active{% endif %}"
					href="/my-comps"
				>
					Home
				</a>

				<a
					class="back {% if nav_active == 'leaderboard' %}active{% endif %}"
					href="/leaderboard"
				>
					Leaderboard
				</a>

				<a
					class="back {% if nav_active == 'login' %}active{% endif %}"
					href="/login"
				>
					Log in
				</a>
			{% endif %}
		</div>
	</nav>

	<main class="container">
		<header class="page-header">
			<h1 class="page-title">
				Upcoming Competitions
			</h1>

			<p class="page-subtitle">
				{% if competitor %}
					Welcome back, {{ competitor.name }}.
					This is your home base for upcoming climbing comps.
				{% else %}
					Welcome to Urban Climb Comp.
					Sign up or log in to see upcoming competitions and track your scoring.
				{% endif %}
			</p>

			<p class="page-hint">
				When a comp is live, head to the gym and scan the QR code to register.
				If you're already registered, you'll see a link to your scoring.
			</p>
		</header>

		{% if not cards or cards|length == 0 %}
			<section class="empty-state">
				<div class="card">
					<h2>No competitions yet</h2>
					<p>
						There are currently no upcoming competitions in the system.
						Check back here when your gym announces their next event.
					</p>
				</div>
			</section>
		{% else %}
			<section class="pill-grid">
				{% for card in cards %}
					{% set c = card.comp %}
					{% set gym_label = (c.gym.name if c.gym else c.gym_name) %}
					{% set badge_class = "status-badge--live" if card.status == "live" else "status-badge--scheduled" %}

					{# ‚úÖ If it has a destination, make the WHOLE pill a link #}
					{% if card.pill_href %}
						<a
							href="{{ card.pill_href }}"
							class="section-pill comp-pill comp-pill-link"
							aria-label="{{ card.pill_title or 'Open' }}: {{ c.name }}"
						>
							<div class="pill-header">
								<h2 class="pill-title">{{ c.name }}</h2>
								{% if gym_label %}
									<p class="pill-subtitle">{{ gym_label }}</p>
								{% endif %}
							</div>

							<div class="pill-meta">
								{% if c.start_at or c.end_at %}
									<p class="pill-dates">
										{% if c.start_at %}
											<span class="pill-date-label">Starts:</span>
											<span class="pill-date-value">
												{{ c.start_at.strftime('%d %b %Y, %I:%M %p') }}
											</span>
										{% endif %}

										{% if c.end_at %}
											<span class="pill-date-separator">¬∑</span>
											<span class="pill-date-label">Ends:</span>
											<span class="pill-date-value">
												{{ c.end_at.strftime('%d %b %Y, %I:%M %p') }}
											</span>
										{% endif %}
									</p>
								{% else %}
									<p class="pill-dates pill-dates--tbc">Dates TBC</p>
								{% endif %}

								<div class="pill-status">
									<span class="status-badge {{ badge_class }}">
										{% if card.my_scoring_url %}
											Keep scoring
										{% elif card.status == 'live' %}
											Register
										{% else %}
											Upcoming
										{% endif %}
									</span>
								</div>
							</div>

							<p class="pill-description">
								{{ card.status_label }}
							</p>

							{# Optional: keep a button-looking hint, but NOT a link #}
							<div class="pill-actions">
								<span class="btn primary">
									{% if card.my_scoring_url %}
										Keep scoring
									{% else %}
										Register
									{% endif %}
								</span>
							</div>
						</a>

					{% else %}
						{# ‚ùå Not clickable (scheduled + not registered) #}
						<article class="section-pill comp-pill">
							<div class="pill-header">
								<h2 class="pill-title">{{ c.name }}</h2>
								{% if gym_label %}
									<p class="pill-subtitle">{{ gym_label }}</p>
								{% endif %}
							</div>

							<div class="pill-meta">
								{% if c.start_at or c.end_at %}
									<p class="pill-dates">
										{% if c.start_at %}
											<span class="pill-date-label">Starts:</span>
											<span class="pill-date-value">
												{{ c.start_at.strftime('%d %b %Y, %I:%M %p') }}
											</span>
										{% endif %}

										{% if c.end_at %}
											<span class="pill-date-separator">¬∑</span>
											<span class="pill-date-label">Ends:</span>
											<span class="pill-date-value">
												{{ c.end_at.strftime('%d %b %Y, %I:%M %p') }}
											</span>
										{% endif %}
									</p>
								{% else %}
									<p class="pill-dates pill-dates--tbc">Dates TBC</p>
								{% endif %}

								<div class="pill-status">
									<span class="status-badge {{ badge_class }}">
										{% if card.status == 'live' %}
											Live now
										{% else %}
											Upcoming
										{% endif %}
									</span>
								</div>
							</div>

							<p class="pill-description">{{ card.status_label }}</p>

							<div class="pill-actions">
								<p class="pill-note">
									Registration will open when this competition goes live.
								</p>
							</div>
						</article>
					{% endif %}
				{% endfor %}
			</section>
		{% endif %}
	</main>
</body>
</html>
