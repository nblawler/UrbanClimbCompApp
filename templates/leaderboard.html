<!doctype html>
<html lang="en">
	<head>
		<meta charset="utf-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1" />
		<title>Leaderboard Â· Urban Climb Comp</title>
		<link rel="stylesheet" href="/static/app.css" />
	</head>
	<body>
		<nav class="container" style="display:flex; gap:12px; align-items:center; margin-top:16px;">
			<a class="back" href="/">Home</a>
		</nav>

		<main class="container">
			<header class="header">
				<h1>Leaderboard</h1>
				<p class="muted">Updates automatically every 5 seconds</p>
			</header>

			<section class="card">
				<table class="leaderboard">
					<thead>
						<tr>
							<th>Position</th>
							<th>Competitor</th>
							<th>Total Points</th>
							<th>Tops</th>
							<th>Attempts</th>
						</tr>
					</thead>
					<tbody>
						{% for row in leaderboard %}
						<tr>
							<td>{{ row.position }}</td>
							<td>#{{ row.competitor_id }}</td>
							<td>{{ row.total_points }}</td>
							<td>{{ row.tops }}</td>
							<td>{{ row.attempts_on_tops }}</td>
						</tr>
						{% endfor %}
					</tbody>
				</table>
			</section>
		</main>

		<script>
			async function refreshLeaderboard() {
				try {
					const res = await fetch('/api/leaderboard', { cache: 'no-store' });
					if (!res.ok) return;
					const data = await res.json();

					const tbody = document.querySelector('.leaderboard tbody');
					const frag = document.createDocumentFragment();

					data.forEach(row => {
						const tr = document.createElement('tr');
						tr.innerHTML = `
							<td>${row.position}</td>
							<td>#${row.competitor_id}</td>
							<td>${row.total_points}</td>
							<td>${row.tops}</td>
							<td>${row.attempts_on_tops}</td>
						`;
						frag.appendChild(tr);
					});

					tbody.replaceChildren(frag);
				} catch (err) {
					console.error('Leaderboard refresh failed:', err);
				}
			}

			refreshLeaderboard();
			setInterval(refreshLeaderboard, 5000); // refresh every 5s
		</script>
	</body>
</html>

